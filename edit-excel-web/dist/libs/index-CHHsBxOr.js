import{d as e,r as l,a,c as o,b as s,w as t,e as u,f as n,g as d,h as r,i,t as c,u as p,F as f,o as y,E as m,j as v,k as h,l as C,m as x,n as g,p as T,q as k,s as _,v as I,x as V,y as b}from"./index-5ITafVn6.js";import{r as w,c as z,u as S,a as E,_ as L,l as F,U,g as B,d as N}from"./index-CKkgec9T.js";const O={class:"dialog-container"},$={class:"code-warp layout-h layout-center gutter-h-small"},j={class:"code-warp layout-h layout-center gutter-h-small"},q={class:"buttons layout-h layout-center"},J=L(e({__name:"index",props:{modelValue:{type:Boolean,default:!1},fileInfo:{default:{}},type:{default:"add"},fileNames:{default:[]},userId:{default:""}},emits:["update:modelValue","handleSuccess"],setup(e,{emit:v}){const h=e,C=v,x=l({name:"",fileType:1,openCodeExpireTime:a().add(10,"day"),shareCode:w(6),openCode:w(6)}),g=l({visible:!0,oldFileType:null}),T=()=>{C("update:modelValue")},k=()=>{if(!x.name)return m.error("请输入文件名"),!1;if(h.fileNames.includes(x.name))return m.error("文件名已存在"),!1;const e="edit"===h.type?S:E,l={name:x.name+".xlsx",userId:h.userId,fileType:x.fileType};"edit"===h.type&&(l.code=h.fileInfo.code),0===x.fileType&&(l.openCode=null,l.openCodeExpireTime=null,l.shareCode=x.shareCode),2===x.fileType&&(l.shareCode=null,l.openCode=x.openCode,l.openCodeExpireTime=a(x.openCodeExpireTime).endOf("day").valueOf()),e(l).then((e=>{m.success("操作成功"),C("handleSuccess",h.type),T()}))};return(()=>{const{name:e,fileType:l,shareCode:a,openCodeExpireTime:o,openCode:s}=h.fileInfo??{};g.oldFileType=l,x.name=e?e.replace(".xlsx",""):"",x.fileType=l??1,0===l&&(x.shareCode=a),2===l&&(x.openCodeExpireTime=o,x.openCode=s)})(),(l,a)=>{const m=s("el-input"),v=s("el-form-item"),h=s("el-radio"),C=s("el-radio-group"),_=s("el-text"),I=s("el-date-picker"),V=s("el-form"),b=s("el-button"),S=s("el-dialog");return y(),o(S,{"before-close":T,width:840,"append-to-body":"","custom-class":"cost-config-dialog",title:"edit"===e.type?"编辑表格信息":"新增表格",modelValue:g.visible,"onUpdate:modelValue":a[7]||(a[7]=e=>g.visible=e)},{default:t((()=>[u("div",O,[n(V,{form:x},{default:t((()=>[n(v,{label:"文件名",prop:"name"},{default:t((()=>[n(m,{class:"simulate-password",ref:"passwordRef",placeholder:"请输入文件名",maxlength:20,"show-word-limit":"",clearable:"",modelValue:x.name,"onUpdate:modelValue":a[0]||(a[0]=e=>x.name=e),modelModifiers:{trim:!0}},{append:t((()=>a[8]||(a[8]=[i(".xlsx")]))),_:1},8,["modelValue"])])),_:1}),n(v,{label:"表格类型",prop:"fileType"},{default:t((()=>[n(C,{modelValue:x.fileType,"onUpdate:modelValue":a[1]||(a[1]=e=>x.fileType=e),disabled:0===g.oldFileType||2===g.oldFileType},{default:t((()=>[n(h,{value:1},{default:t((()=>a[9]||(a[9]=[i("私有")]))),_:1}),n(h,{value:0},{default:t((()=>a[10]||(a[10]=[i("共享")]))),_:1}),n(h,{value:2},{default:t((()=>a[11]||(a[11]=[i("开放")]))),_:1})])),_:1},8,["modelValue","disabled"])])),_:1}),2===x.fileType?(y(),d(f,{key:0},[n(v,{label:"开放码",prop:"openCode"},{default:t((()=>[u("span",$,c(x.openCode),1),a[14]||(a[14]=i()),n(_,{class:"gutter-h-small cursor",type:"primary",onClick:a[2]||(a[2]=e=>x.openCode=p(w)(6))},{default:t((()=>a[12]||(a[12]=[i("重新生成 ")]))),_:1}),n(_,{class:"cursor",type:"primary",onClick:a[3]||(a[3]=e=>p(z)(x.openCode))},{default:t((()=>a[13]||(a[13]=[i("复制")]))),_:1})])),_:1}),n(v,{label:"开放失效日期",prop:"openCodeExpireTime"},{default:t((()=>[n(I,{modelValue:x.openCodeExpireTime,"onUpdate:modelValue":a[4]||(a[4]=e=>x.openCodeExpireTime=e),type:"date",placeholder:"失效日期"},null,8,["modelValue"])])),_:1})],64)):r("",!0),0===x.fileType?(y(),o(v,{key:1,label:"共享码",prop:""},{default:t((()=>[u("span",j,c(x.shareCode),1),a[17]||(a[17]=i()),n(_,{class:"gutter-h-small cursor",type:"primary",onClick:a[5]||(a[5]=e=>x.shareCode=p(w)(6))},{default:t((()=>a[15]||(a[15]=[i("重新生成 ")]))),_:1}),n(_,{class:"cursor gutter-h-small",type:"primary",onClick:a[6]||(a[6]=e=>p(z)(x.shareCode))},{default:t((()=>a[16]||(a[16]=[i("复制")]))),_:1}),a[18]||(a[18]=u("span",{style:{color:"#999"}},"注意：共享码修改成功，原共享者将被清除！",-1))])),_:1})):r("",!0),n(v,{label:"类型解析",prop:"fileType"},{default:t((()=>a[19]||(a[19]=[u("div",null,"私有表格, 只有创建者具有该表格的编辑， 删除等权限, 私有表格可以转变成共享表格，开放表格 。",-1),u("div",null,"共享表格, 只要是该表格的共享者，就具有编辑的权限， 不包括删除和添加共享者的权限。",-1),u("div",null,"开放表格, 获得开放码的游客就具有编辑表格的权限。",-1)]))),_:1})])),_:1},8,["form"]),u("div",q,[n(b,{onClick:T,class:"custom-gray"},{default:t((()=>a[20]||(a[20]=[i("取消")]))),_:1}),n(b,{type:"primary",onClick:k,class:"custom"},{default:t((()=>a[21]||(a[21]=[i("提交")]))),_:1})])])])),_:1},8,["title","modelValue"])}}}),[["__scopeId","data-v-038b5138"]]),R={class:"home-head-warp layout-h layout-space-between"},H={key:0,class:"layout-h layout-h-center"},M={class:"layout-h layout-h-center cursor",style:{"font-size":"12px"}},A={class:"",style:{"font-size":"14px",color:"var(--el-color-primary)","text-decoration":"underline"}},D={key:1,class:"layout-h layout-h-center",style:{"font-size":"14px",color:"var(--el-color-warning)"}},G={key:2,class:"layout-h layout-h-center"},K={style:{"font-size":"14px",color:"var(--el-color-primary)"}},P={key:3,class:"layout-h layout-h-center"},Q=L(e({__name:"index",setup(e){const l=x(),a=v(null),w=v(!1),S=v("login"),E=v({}),L=v("add"),O=v(!1),$=v(""),j=h((()=>{var e;return(null==(e=E.value.fileList)?void 0:e.find((e=>e.code===$.value)))??{}})),q=(e="login")=>{S.value=e,w.value=!0},Q=(e="add")=>{L.value=e,O.value=!0},W=(e=null)=>{if(!E.value.id)return!1;B({userId:E.value.id}).then((l=>{E.value.fileList=l.data,e&&e()}))},X=e=>{$.value=e.code,sessionStorage.setItem("currentFileCode",$.value)},Y=(e="edit")=>{"edit"===e?W():W((()=>{X(E.value.fileList[0])}))},Z=(e={})=>{E.value=e,sessionStorage.setItem("userInfo",JSON.stringify(e)),Y("loginScuess")},ee=()=>{g.confirm(`确定删除'${j.value.name}'？`,"提示",{cancelButtonText:"取消",confirmButtonText:"确定"}).then((()=>{N({code:j.value.code,userId:E.value.id}).then((e=>{m.success("删除成功"),Y("delete")}))}))},le=()=>{g.confirm("确定退出登录？","提示",{cancelButtonText:"取消",confirmButtonText:"退出"}).then((()=>{m.success("退出登录"),E.value={},sessionStorage.removeItem("userInfo"),sessionStorage.removeItem("currentFileCode"),window.location.reload()}))},ae=()=>{const e=`${window.location.origin}/excelTbale?code=${j.value.code}&fileType=${j.value.fileType}`;z(e,"链接已经复制到剪贴板")},oe=()=>{const e=2===j.value.fileType?j.value.openCode:j.value.shareCode,l=(2===j.value.fileType?"开放码":"共享码")+"已经复制到剪贴板";z(e,l)},se=()=>{var e;null==(e=a.value)||e.downloadExcel()},te=()=>{var e;null==(e=a.value)||e.commitUpdateTyle1(),m.success("文件保存成功")};return C((()=>{const{fileCode:e}=l.query,a=sessionStorage.getItem("userInfo");a&&(E.value=JSON.parse(a)),E.value.id&&W((()=>{var l,a;const o=e||sessionStorage.getItem("currentFileCode")||"",s=null==(l=E.value.fileList)?void 0:l.find((e=>e.code===o));$.value=s?s.code:null==(a=E.value.fileList[0])?void 0:a.code}))})),(e,l)=>{const m=s("el-icon"),v=s("el-dropdown-item"),h=s("el-dropdown-menu"),C=s("el-dropdown");return y(),d(f,null,[u("div",R,[E.value.id?(y(),d("div",H,[n(C,{class:"gutter-h",trigger:"click"},{dropdown:t((()=>[n(h,null,{default:t((()=>[(y(!0),d(f,null,k(E.value.fileList,(e=>(y(),o(v,{key:e.code,onClick:l=>X(e)},{default:t((()=>[u("span",{class:_(e.code===j.value.code?"act":"")},c(e.name)+" ["+c(["共享","私有","开放"][e.fileType])+"]",3)])),_:2},1032,["onClick"])))),128))])),_:1})])),default:t((()=>{var e;return[u("div",M,[i(" 我的文件("+c((null==(e=E.value.fileList)?void 0:e.length)??0)+") ",1),n(m,{class:"el-icon--right"},{default:t((()=>[n(p(T))])),_:1})])]})),_:1}),j.value.code?(y(),d(f,{key:0},[l[6]||(l[6]=u("span",null,"当前文件：",-1)),u("div",A,c(j.value.name)+" ["+c(["共享","私有","开放"][j.value.fileType])+"] ",1),l[7]||(l[7]=i("     ")),E.value.id?(y(),o(m,{key:0,color:"#666",size:14,class:"gutter-h-small cursor",title:"编辑",onClick:l[0]||(l[0]=e=>Q("edit"))},{default:t((()=>[n(p(I))])),_:1})):r("",!0),n(m,{color:"#666",size:14,class:"gutter-h-small cursor",title:"手动保存",onClick:te},{default:t((()=>[n(p(V))])),_:1}),E.value.fileList.length>1?(y(),o(m,{key:1,color:"#666",size:14,class:"gutter-hsmall cursor",title:"删除",onClick:ee},{default:t((()=>[n(p(b))])),_:1})):r("",!0)],64)):r("",!0)])):(y(),d("div",D,l[8]||(l[8]=[u("span",null,"注意: 现在是游客模式，编辑的数据不会保存！",-1)]))),E.value.id?(y(),d("div",G,[u("span",{class:"gutter-h cursor",style:{"font-size":"12px","text-decoration":"underline"},onClick:l[1]||(l[1]=e=>Q("add"))},"新增表格"),u("span",{class:"gutter-h cursor",style:{"font-size":"12px","text-decoration":"underline"},onClick:ae},"分享链接"),2===j.value.fileType?(y(),d("span",{key:0,class:"gutter-h cursor",style:{"font-size":"12px","text-decoration":"underline"},onClick:oe},"开放码")):r("",!0),0===j.value.fileType?(y(),d("span",{key:1,class:"gutter-h cursor",style:{"font-size":"12px","text-decoration":"underline"},onClick:oe},"共享码")):r("",!0),u("span",{class:"gutter-h cursor",style:{"font-size":"12px","text-decoration":"underline"},onClick:se},"导出表格"),u("span",K,c(E.value.name),1),l[9]||(l[9]=i("   [")),u("span",{style:{"font-size":"12px",color:"var(--el-color-error)"},class:"cursor",onClick:le},"退出"),l[10]||(l[10]=i("] "))])):(y(),d("div",P,[u("span",{style:{"font-size":"14px"},class:"cursor",onClick:l[2]||(l[2]=e=>q("login"))},"请登录"),l[11]||(l[11]=i("   [")),u("span",{style:{"font-size":"12px",color:"var(--el-color-info)"},class:"cursor",onClick:l[3]||(l[3]=e=>q("register"))},"未注册？"),l[12]||(l[12]=i("] "))]))]),(y(),o(F,{ref_key:"luckySheetRef",ref:a,key:$.value,fileCode:$.value,userInfo:E.value},null,8,["fileCode","userInfo"])),O.value?(y(),o(J,{key:0,modelValue:O.value,"onUpdate:modelValue":l[4]||(l[4]=e=>O.value=e),type:L.value,onHandleSuccess:Y,userId:E.value.id,fileInfo:"edit"===L.value?j.value:{}},null,8,["modelValue","type","userId","fileInfo"])):r("",!0),w.value?(y(),o(U,{key:1,modelValue:w.value,"onUpdate:modelValue":l[5]||(l[5]=e=>w.value=e),type:S.value,onLoginSuccess:Z},null,8,["modelValue","type"])):r("",!0)],64)}}}),[["__scopeId","data-v-d0c2a035"]]);export{Q as default};
