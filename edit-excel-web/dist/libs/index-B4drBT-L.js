import{d as e,r as l,c as a,b as o,w as t,e as u,f as s,i as r,t as n,o as i,E as d,l as c,m as v,g as f,h as p,u as m,F as y,q as h,p as w,B as k}from"./index-Bx_zgH5G.js";import{_ as g,H as x,l as I,U as _,e as T,f as C,h as V,j as b}from"./helper-CgziLt6j.js";const z={class:"dialog-container"},$={class:"buttons layout-h layout-center"},U=g(e({__name:"index",props:{modelValue:{type:Boolean,default:!1},fileInfo:{default:{}}},emits:["update:modelValue","commit","cancel"],setup(e,{emit:c}){const v=c,f=l({code:""}),p=l({visible:!0}),m=()=>{v("cancel"),v("update:modelValue")},y=()=>{if(!f.code)return d.error("不能为空"),!1;v("commit",f.code)};return(l,d)=>{const c=o("el-input"),v=o("el-form-item"),h=o("el-form"),w=o("el-button"),k=o("el-dialog");return i(),a(k,{"before-close":m,width:600,"append-to-body":"","custom-class":"cost-config-dialog",title:2===e.fileInfo.fileType?"校验开放码":"成为文件共享者",modelValue:p.visible,"onUpdate:modelValue":d[2]||(d[2]=e=>p.visible=e)},{default:t((()=>[u("div",z,[2===e.fileInfo.fileType?(i(),a(h,{key:0,form:f},{default:t((()=>[s(v,{label:"开放码",prop:"code"},{default:t((()=>[s(c,{class:"simulate-password",placeholder:"请输入6位数字的开放码",clearable:"",modelValue:f.code,"onUpdate:modelValue":d[0]||(d[0]=e=>f.code=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),s(v,{label:"温馨提示",prop:"code"},{default:t((()=>{var l;return[r(" 文件需要校验开发码通过后, 才可以编辑，如未获得开放码， 请联系[ "+n(null==(l=e.fileInfo)?void 0:l.name)+" ]的文件所有者 ",1)]})),_:1})])),_:1},8,["form"])):(i(),a(h,{key:1,form:f},{default:t((()=>[s(v,{label:"共享码",prop:"code"},{default:t((()=>[s(c,{class:"simulate-password",placeholder:"请输入6位数字的共享码",clearable:"",modelValue:f.code,"onUpdate:modelValue":d[1]||(d[1]=e=>f.code=e),modelModifiers:{trim:!0}},null,8,["modelValue"])])),_:1}),s(v,{label:"温馨提示",prop:"code"},{default:t((()=>{var l;return[r(" 文件需要校验共享码通过后, 即可成为文件共享者，如未获得共享码， 请联系[ "+n(null==(l=e.fileInfo)?void 0:l.name)+" ]的文件所有者 ",1)]})),_:1})])),_:1},8,["form"])),u("div",$,[s(w,{onClick:m,class:"custom-gray"},{default:t((()=>d[3]||(d[3]=[r("取消")]))),_:1}),s(w,{type:"primary",onClick:y,class:"custom"},{default:t((()=>d[4]||(d[4]=[r("提交")]))),_:1})])])])),_:1},8,["title","modelValue"])}}}),[["__scopeId","data-v-ca81972e"]]),B={class:"home-head-warp layout-h layout-space-between"},S={class:"layout-h layout-h-center"},j={style:{"font-size":"14px",color:"var(--el-color-primary)","text-decoration":"underline"},class:"gutter-h"},L={key:0,class:"layout-h layout-h-center",style:{"font-size":"14px",color:"var(--el-color-warning)"}},q={class:"layout-h layout-h-center"},E={style:{"font-size":"14px",color:"var(--el-color-primary)","text-decoration":"underline"}},M={key:3,class:"layout-h layout-h-center"},W=g(e({__name:"index",setup(e){const l=new x,g=w(),z=c(null),$=c(""),W=c(!1),D=c("login"),F=l.userInfo,H=c(!1),R=c(!1),A=c(""),G=c({}),J=v((()=>G.value.code+$.value)),K=(e="login")=>{D.value=e,W.value=!0},N=()=>{h.confirm("确定退出登录？","提示",{cancelButtonText:"取消",confirmButtonText:"退出"}).then((()=>{l.handleLogout()}))},O=()=>{l.shareUrl(G.value.code,G.value.fileType)},P=()=>{window.location.href="/"},Q=(e=null)=>{A.value=e??G.value.code,H.value=!1,$.value=Date.now()},X=(e="")=>{var l;if(2===G.value.fileType){if(!/^\d{6}$/.test(e))return d.error("请输入6位数字开放码， 不含空格"),!1;V({openCode:e,code:G.value.code,userId:null==(l=F.value)?void 0:l.id}).then((l=>{if(0===l.data)return d.success("开放码校验成功"),A.value=G.value.code,window.localStorage.setItem(`${G.value.code}`,e),Q(),R.value=!1,!1;if(3===l.data)return window.localStorage.setItem(`${G.value.code}`,e),d.success("您是文件的创建者， 即将返回系统首页"),setTimeout((()=>{window.location.href=`/index?fileCode=${G.value.code}`}),3e3),fasle;const a=1===l.data?"当前开放码已失效":"开放码错误";d.error(a)}))}if(0===G.value.fileType){if(!/^\d{6}$/.test(e))return d.error("请输入6位数字共享码， 不含空格"),!1;b({code:G.value.code,userId:F.value.id,shareCode:e}).then((e=>{e.data===G.value.code&&(R.value=!1,Q(),d.success("恭喜你成为本文件共享者"))}))}},Y=async()=>{var e;if(0!==(null==(e=G.value)?void 0:e.fileType))return!1;if(H.value=!0,A.value=G.value.code,F.value.id){const e=await C({code:G.value.code,userId:F.value.id});if(0===e.data)return R.value=!0,!1;if(1===e.data)return Q(),!1;2===e.data&&(d.success("您是文件的创建者， 即将返回系统首页"),setTimeout((()=>{window.location.href=`/index?fileCode=${G.value.code}`}),3e3))}},Z=()=>{var e;null==(e=z.value)||e.downloadExcel()},ee=(e={})=>{var a;l.handleLogin(e),0===(null==(a=G.value)?void 0:a.fileType)&&Y()};return(async()=>{const{code:e}=g.query;if(l.initUserInfo(),!e)return window.location.href="/",!1;try{const l=await T({code:e});G.value=l.data,Y(),(()=>{var e,l;if(1===(null==(e=G.value)?void 0:e.fileType)){const e=`${null==(l=G.value)?void 0:l.name}为私有文件，不对外公开，请返回首页`;h.alert(e,"提示",{confirmButtonText:"去首页",callback:()=>{window.location.href="/"}})}})(),(async(e="")=>{var l,a;if(2===(null==(l=G.value)?void 0:l.fileType)){const l="2208380315965186"===e?"392820":window.localStorage.getItem(`${G.value.code}`);if(l){const e=await V({openCode:l,code:G.value.code,userId:(null==(a=F.value)?void 0:a.id)??null});if(0===e.data)return Q(),!1;if(3===e.data)return d.success("您是文件的创建者， 即将返回系统首页"),setTimeout((()=>{window.location.href=`/index?fileCode=${G.value.code}`}),2e3),!1;H.value=!0,R.value=!0,A.value=G.value.code}else R.value=!0,H.value=!0,A.value=G.value.code}})(e)}catch(a){}})(),(e,l)=>{const d=o("el-icon");return i(),f(y,null,[u("div",B,[u("div",S,[s(d,{color:"#666",size:16,class:"gutter-h cursor",title:"首页",onClick:P},{default:t((()=>[s(m(k))])),_:1}),u("span",null,"当前文件["+n(["共享","私有","开放"][G.value.fileType])+"文件]：",1),u("div",j,n(G.value.name),1)]),m(F).id||0!==G.value.fileType?p("",!0):(i(),f("div",L,l[5]||(l[5]=[u("span",null,"注意: 本文件为共享文件， 需要用户登录后，填写共享码成为文件共享者，才有相关权限！",-1)]))),u("div",q,[2===G.value.fileType&&H.value?(i(),f("span",{key:0,class:"gutter-h cursor",style:{"font-size":"12px",color:"var(--el-color-info)"},onClick:l[0]||(l[0]=e=>R.value=!0)},"开放码校验")):p("",!0),m(F).id||0!==G.value.fileType?(i(),f(y,{key:1},[u("span",{class:"gutter-h cursor",style:{"font-size":"12px",color:"var(--el-color-info)"},onClick:Z},"导出表格"),u("span",{class:"gutter-h cursor",style:{"font-size":"12px",color:"var(--el-color-info)"},onClick:O},"分享链接")],64)):p("",!0),m(F).id?(i(),f(y,{key:2},[u("span",E,n(m(F).name),1),l[6]||(l[6]=r("   [")),u("span",{style:{"font-size":"12px",color:"var(--el-color-error)"},class:"cursor",onClick:N},"退出"),l[7]||(l[7]=r("] "))],64)):(i(),f("div",M,[u("span",{style:{"font-size":"14px"},class:"cursor",onClick:l[1]||(l[1]=e=>K("login"))},"请登录"),l[8]||(l[8]=r("   [")),u("span",{style:{"font-size":"12px",color:"var(--el-color-info)"},class:"cursor",onClick:l[2]||(l[2]=e=>K("register"))},"未注册？"),l[9]||(l[9]=r("] "))]))])]),(i(),a(I,{ref_key:"luckySheetRef",ref:z,key:J.value,fileCode:A.value,userInfo:m(F),showWatermark:H.value},null,8,["fileCode","userInfo","showWatermark"])),W.value?(i(),a(_,{key:0,modelValue:W.value,"onUpdate:modelValue":l[3]||(l[3]=e=>W.value=e),type:D.value,onLoginSuccess:ee},null,8,["modelValue","type"])):p("",!0),R.value?(i(),a(U,{key:1,modelValue:R.value,"onUpdate:modelValue":l[4]||(l[4]=e=>R.value=e),fileInfo:G.value,type:D.value,onCommit:X},null,8,["modelValue","fileInfo","type"])):p("",!0)],64)}}}),[["__scopeId","data-v-99a7d031"]]);export{W as default};
